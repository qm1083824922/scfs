<div class="wrapper">
  <ol class="breadcrumb">
    <li>当前位置</li>
    <li>销售</li>
    <li>销售单</li>  
    <li class="active">基本信息编辑</li>
  </ol>
  <section class="product-wrap">
        <div class="box no-margin"> 
          <form class="form-horizontal form-inline" id="billDeliveryEditForm" data-url="billDelivery/edit">
            <div class="box-body">
                <ul class="nav nav-tabs"> 	  
               	  <li role="presentation" class="active"><a class="tab-item" data-url="html/sale/billDelivery/billDeliveryEdit.html">基础信息</a></li>
                  <li role="presentation"><a class="tab-item" data-url="html/sale/billDelivery/billDeliveryDtlEdit.html">销售明细</a></li>
                   <li role="presentation"><a class="tab-item" data-url="html/sale/billDelivery/attachment.html">附件</a></li>
                </ul>
                 <input class="js-initform" type="hidden" id="id" name="id">
                
                 <table class="table table-bordered table-hover no-margin">
            	  <tr>
                    <td width="180" class="text-right"><b>销售编号：</b></td>
                    <td class="text-left">
                      <label class="js-initform" id="billNo" name="billNo"></label>
                    </td>
                  </tr>
            	  <tr>
                    <td class="text-right"><b>销售附属编号：<em class="text-star">*</em></b></td>
                    <td class="text-left">
                      <input style="width:300px" type="text" class="form-control js-initform" id="affiliateNo" name="affiliateNo">
                    </td>
                  </tr>

                     <tr>
                         <td class="text-right"><b>销售类型：<em class="text-star">*</em></b></td>
                         <td class="text-left">
                             <label class="js-initform" id="billTypeName" name="billTypeName"></label>
                             <input class="js-initform" type="hidden" id="billType" name="billType">
                         </td>
                     </tr>

               	  <tr>
                    <td class="text-right"><b>项目：<em class="text-star">*</em></b></td>
                    <td class="text-left">
                        <label class="js-initform" id="projectName" name="projectName"></label>
                    	<input class="js-initform" type="hidden" id="projectId" name="projectId">
                    </td>
                  </tr>
                  <tr>
                    <td class="text-right"><b>销售仓库：<em class="text-star">*</em></b></td>
                    <td class="text-left">
                        <label class="js-initform" id="warehouseName" name="warehouseName"></label>
                    	<input class="js-initform" type="hidden" id="warehouseId" name="warehouseId">
                    </td>
                  </tr>
                  <tr>
                    <td class="text-right"><b>客户：<em class="text-star">*</em></b></td>
                    <td class="text-left">
                        <label class="js-initform" id="customerName" name="customerName"></label>
                    	<input class="js-initform" type="hidden" id="customerId" name="customerId">
                    </td>
                  </tr>


                     <tr>
                         <td class="text-right"><b>接收项目： </b></td>
                         <td class="text-left">
                             <label class="js-initform" id="receiveProjectName" name="receiveProjectName"></label>
                             <input class="js-initform" type="hidden" id="receiveProjectId" name="receiveProjectId">
                         </td>
                     </tr>


                     <tr>
                         <td class="text-right"><b>接收供应商： </b></td>
                         <td class="text-left">
                             <label class="js-initform" id="receiveSupplierName" name="receiveSupplierName"></label>
                             <input class="js-initform" type="hidden" id="receiveSupplierId" name="receiveSupplierId">
                         </td>
                     </tr>
                     <tr>
                         <td class="text-right"><b>接收仓库： </b></td>
                         <td class="text-left">
                             <label class="js-initform" id="receiveWarehouseName" name="receiveWarehouseName"></label>
                             <input class="js-initform" type="hidden" id="receiveWarehouseId" name="receiveWarehouseId">
                         </td>
                     </tr>



                  <tr>
                    <td class="text-right"><b>运输方式：<em class="text-star">*</em></b></td>
                    <td class="text-left">
                       <select style="width:300px" class="form-control js-initform" data-url="BILL_OUT_STORE_TRANSFER_MODE" id="transferMode" name="transferMode"></select>
                    </td>
                  </tr>
                  <tr>
                    <td class="text-right"><b>收货地址：<em class="text-star cls_customerAddressId">*</em></b></td>
                    <td class="text-left">
                       <select style="width:300px" class="form-control js-initform" data-url="SUBJECT_ADDRESS" id="customerAddressId" pid="customerId" name="customerAddressId"></select>                   
                    </td>
                  </tr> 
                  <tr>
                    <td class="text-right"><b>销售日期：<em class="text-star">*</em></b></td>
                    <td class="text-left">
                      <input style="width:300px" type="text" class="form-control js-initform js_datePicker" id="requiredSendDate" name="requiredSendDate">
                    </td>
                  </tr>                
                  <tr>
                    <td class="text-right"><b>币种：<em class="text-star">*</em></b></td>
                    <td class="text-left">
                        <label class="js-initform" id="currencyTypeName" name="currencyTypeName"></label>
                    	<input class="js-initform" type="hidden" id="currencyType" name="currencyType">
                    </td>
                  </tr>
                  <tr>
                    <td class="text-right"><b>签收标准：<em class="text-star">*</em></b></td>
                    <td class="text-left">
                      <select class="form-control js-initform" data-url="SIGN_STANDARD" id="signStandard" name="signStandard"></select>
                    </td>
                  </tr>
                  <tr class="tr_certificateName">
                    <td class="text-right"><b>签收人：<em class="text-star">*</em></b></td>
                    <td class="text-left">
                      <input style="width:300px" class="form-control js-initform" id="certificateName" name="certificateName"></input>
                    </td>
                  </tr>
                  <tr class="tr_certificateId">
                    <td class="text-right"><b>身份证：<em class="text-star">*</em></b></td>
                    <td class="text-left">
                      <input style="width:300px" class="form-control js-initform" id="certificateId" name="certificateId"></input>
                    </td>
                  </tr>
                  <tr class="tr_officialSeal">
                    <td class="text-right"><b>公章：<em class="text-star">*</em></b></td>
                    <td class="text-left">
                      <input style="width:300px" class="form-control js-initform" id="officialSeal" name="officialSeal"></input>
                    </td>
                  </tr>
                  <tr>
                    <td class="text-right"><b>回款时间：</b></td>
                    <td class="text-left"><label class="js-initform" id="returnTime"></label></td>
                  </tr> 
                  <tr>
                    <td class="text-right"><b>创建人：</b></td>
                    <td class="text-left"><label class="js-initform" id="creator"></label></td>
                  </tr>  
                  <tr>
                    <td class="text-right"><b>创建时间：</b></td>
                    <td class="text-left"><label class="js-initform" id="createAt"></label></td>
                  </tr>   
                  <tr>
                    <td class="text-right"><b>备注：</b></td>
                    <td class="text-left">
                      <textarea class="form-control js-initform" id="remark" cols="50" rows="5" name="remark"></textarea>  
                    </td>
                  </tr>
               </table>
            </div>
            <!-- /.box-body -->

            <div class="box-footer text-center">
              <button type="submit" id="save" class="btn btn-primary btn-sm" data-permissionUrl="/billDelivery/update" data-url="billDelivery/update">保存</button>
              <button type="button" data-url="html/sale/billDelivery/billDeliverySearch.html" class="btn btn-default btn-sm js-back">返回</button>
            </div>
            <!-- /.box-footer -->

          </form>
        </div>
  </section>
</div>
 
<script>
  options.initPage = function(){
  	  GLOBAL.getEditData($("#billDeliveryEditForm"), options.param.id);
      $(".js_datePicker").datetimepicker({format:"Y-m-d", timepicker:false});
      
	  var customerAddressIdrequired = true;
      var transferMode = $("#transferMode").val();
      if (transferMode == 1) {
    	  $(".cls_customerAddressId").hide();
    	  customerAddressIdrequired = false;
      }
      var signStandard = $("#signStandard").val();
      if (signStandard == 0) {	//0-身份证  
      	  $(".tr_certificateName").show(); 		
      	  $(".tr_certificateId").show();	 		
      	  $(".tr_officialSeal").hide();
      } else if (signStandard == 1) {	//1-公章 
      	  $(".tr_certificateName").hide();				
      	  $(".tr_certificateId").hide();				
      	  $(".tr_officialSeal").show();
      } else if (signStandard == 2) {	//2-身份证和公章
      	  $(".tr_certificateName").show();	 		
      	  $(".tr_certificateId").show();	 		
      	  $(".tr_officialSeal").show();
      } else if (signStandard == 3) {	//3-见环球签收标准
    	  $(".tr_certificateName").hide(); 		
      	  $(".tr_certificateId").hide();	 		
      	  $(".tr_officialSeal").hide();
      }
      
      $("#transferMode").change(function(){
          var thisValue = $(this).val();
          if (thisValue == 1) {	//1-自提
          	  $(".cls_customerAddressId").hide();
          	  $("#customerAddressId").val("");
 			  $("#customerAddressId").rules("remove");  
          } else {
          	  $(".cls_customerAddressId").show();            	
  	 		  $("#customerAddressId").rules("add", {required: true});
          }
      });
      $("#customerAddressId").change(function(){
    	  var transferMode2 = $("#transferMode").val();
          if (transferMode2 == 1) {	//1-自提
 		      $("#customerAddressId").rules("remove");  
          } else {
  	 		  $("#customerAddressId").rules("add", {required: true});
          }
      });
      $("#signStandard").change(function(){
          var thisValue = $(this).val();
          if (thisValue === "" || thisValue == 3) {
        	  $(".tr_certificateName").hide();
          	  $("#certificateName").val("");
 			  $("#certificateName").rules("remove");
 				
          	  $(".tr_certificateId").hide();
          	  $("#certificateId").val("");
 			  $("#certificateId").rules("remove");
 			  
          	  $(".tr_officialSeal").hide();
          	  $("#officialSeal").val("");
 			  $("#officialSeal").rules("remove");
          } else if (thisValue == 0) {	//0-身份证  
          	  $(".tr_certificateName").show();
  	 		  $("#certificateName").rules("add", {required: true});
  	 		
          	  $(".tr_certificateId").show();
  	 		  $("#certificateId").rules("add", {required: true});
  	 		
          	  $(".tr_officialSeal").hide();
          	  $("#officialSeal").val("");
 			  $("#officialSeal").rules("remove");
          } else if (thisValue == 1) {	//1-公章 
          	  $(".tr_certificateName").hide();
          	  $("#certificateName").val("");
 			  $("#certificateName").rules("remove");
 				
          	  $(".tr_certificateId").hide();
          	  $("#certificateId").val("");
 			  $("#certificateId").rules("remove");
 				
          	  $(".tr_officialSeal").show();
 			  $("#officialSeal").rules("add", {required: true}); 
          } else if (thisValue == 2) {	//2-身份证和公章
          	  $(".tr_certificateName").show();
  	 		  $("#certificateName").rules("add", {required: true});
  	 		
          	  $(".tr_certificateId").show();
  	 		  $("#certificateId").rules("add", {required: true});
  	 		
          	  $(".tr_officialSeal").show();
 			  $("#officialSeal").rules("add", {required: true}); 
          }
      });
      
      $("#billDeliveryEditForm").validate({
          rules: {
          	  affiliateNo: {
        	      required: true
        	  },
        	  projectId: {
                  required: true
              },
              supplierId: {
                  required: true
              },
              customerId: {
                  required: true
              },
              warehouseId: {
              	  required: true
              },
              receiveWarehouseId: {
              	  required: true
              },
              customerAddressId: {
              	  required: customerAddressIdrequired
              },
              currencyType: {
              	  required: true
              },
              requiredSendDate: {
              	  required: true
              },
              transferMode: {
              	  required: true
              },
              signStandard: {
              	  required: true
              },
              certificateName: {
              	  required: true
              },
              certificateId: {
              	  required: true 
              },
              officialSeal: {
              	  required: true
              }
          },
          submitHandler: function() {
        	  var formData = $("#billDeliveryEditForm").serializeObject();
              GLOBAL.ajax("billDelivery/update", formData, function(e) {
                  if (e.success) {
                      layer.msg("保存成功！");
                  } else {
                      layer.msg(e.msg);
                  }
              });
           }
      });
  }

  GLOBAL.goBack();

</script>
